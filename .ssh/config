# See http://go/corp-ssh-helper#only-off-corp.
# Note the negation "!".
Match host *.corp.google.com !exec "curl -sI https://uberproxy-debug.corp.google.com/oncorp | grep -iq '^Location: .*/no'"
  ProxyCommand none

# See http://go/corp-ssh-helper#only-off-corp.
# Note the negation "!".
Match host *.c.googlers.com !exec "/usr/local/bin/corp-ssh-helper -check"
  ProxyCommand none

Host *
  # Always use SSH2.
  Protocol 2
  # Keep connections.
  ServerAliveInterval 30
  ServerAliveCountMax 6
  # You don't need TCPKeepAlive if ServerAlive* is on.
  TCPKeepAlive no
  # No compression.
  Compression no

# SSH multiplexing. Do not apply it globally. SSHing to some hosts, for example
# Bitbucket, will encounter authentication errors.
# See https://companydoc.corp.google.com/company/corp/ssh/faq/index.md?cl=head#fewer-touches.
Host *.corp.google.com *.c.googlers.com
  ControlMaster auto
  ControlPath ~/.ssh/master-%r@%h:%p
  ControlPersist 240m

Host bitbucket.org
  # See https://unix.stackexchange.com/a/124170.
  IdentityFile ~/.ssh/id_rsa
  IdentitiesOnly yes
